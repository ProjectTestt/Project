<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="style.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Pinyon+Script&display=swap" rel="stylesheet">
    <title>Save & Share</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="darkmode.js"></script>
</head>
<body>
    <a href="Theme1.html" class="back-btn" aria-label="Back to editor">â†</a>
    <img src="images/flowrsForwellcome.png" alt="Flower" id="headerFlower"/>
    
    <main id="save-center">
        <h2 class="save-title">Your Message is Ready!</h2>
        
        <div class="preview-container" id="captureContainer">
            <img src="images/cardTh1.png" alt="letter" id="previewLetter"/>
            <div class="preview-text" id="previewText"></div>
        </div>

        <div class="button-group"></div>

        <!-- Share Link Section -->
        <div class="share-link-section">
            <h3>Share Your Message</h3>
            <div class="link-input-group">
                <input type="text" class="share-link-input" id="shareLink" readonly placeholder="Your share link...">
                <button class="copy-link-btn" id="copyLinkBtn">Copy</button>
            </div>
            <div class="social-buttons">
                <button class="social-btn whatsapp" id="socialWhatsapp">ğŸ’š WhatsApp</button>
                <button class="social-btn instagram" id="socialInstagram">ğŸ“· Instagram</button>
                <button class="social-btn snapchat" id="socialSnapchat">ğŸ‘» Snapchat</button>
                <button class="social-btn twitter" id="socialTwitter">ğ• Twitter</button>
            </div>
        </div>
    </main>

    <canvas id="imageCanvas"></canvas>

    <script>
(function() {

    const previewText = document.getElementById('previewText');
    const captureContainer = document.getElementById('captureContainer');

    const message = localStorage.getItem('message') || '';
    previewText.textContent = message;
    previewText.style.whiteSpace = 'pre-wrap';
    previewText.style.overflowWrap = 'break-word';

    // ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø­ÙŠØ« ÙŠØªØ¶Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ€ parameter
    const encodedMessage = encodeURIComponent(message);
    const shareUrl = window.location.origin + window.location.pathname.replace('SavePage.html', 'ViewMessage.html') + '?message=' + encodedMessage;
    document.getElementById('shareLink').value = shareUrl;

    //===== ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© =====
    async function generateImageBlob() {
        const canvas = await html2canvas(captureContainer, {
            backgroundColor: '#f3eee2',
            scale: 2,
        });

        return new Promise(resolve => {
            canvas.toBlob(blob => resolve(blob), "image/png");
        });
    }

    //===== Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ±Ø© =====
    async function shareImageDirect() {
        const blob = await generateImageBlob();
        if (!blob) return alert("Failed to create image.");

        const file = new File([blob], "message.png", { type: "image/png" });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
                await navigator.share({
                    files: [file],
                    text: "Check my message!",
                });
            } catch (e) {
                console.log("Share canceled", e);
            }
        } else {
            alert("Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ± Ù…Ø¨Ø§Ø´Ø±Ø©.");
        }
    }

    // -------------------------------
    // == Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØµØ§Øª ==
    // -------------------------------

    // ÙˆØ§ØªØ³Ø§Ø¨ (ÙŠØ±Ø³Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©)
    document.getElementById("socialWhatsapp").addEventListener("click", async () => {
        await shareImageDirect();
    });

    // Ø³Ù†Ø§Ø¨ (ÙŠØ´Ø§Ø±Ùƒ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©)
    document.getElementById("socialSnapchat").addEventListener("click", async () => {
        await shareImageDirect();
    });

    // Ø§Ù†Ø³ØªØºØ±Ø§Ù… (ÙŠØ´Ø§Ø±Ùƒ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©)
    document.getElementById("socialInstagram").addEventListener("click", async () => {
        await shareImageDirect();
    });

    // ØªÙˆÙŠØªØ± (ÙŠØ¯Ø¹Ù… Web Share ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©)
    document.getElementById("socialTwitter").addEventListener("click", async () => {
        await shareImageDirect();
    });

    // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
    document.getElementById("copyLinkBtn").addEventListener("click", () => {
        const shareLink = document.getElementById("shareLink");
        
        // Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        navigator.clipboard.writeText(shareLink.value).then(() => {
            // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
            const originalText = document.getElementById("copyLinkBtn").textContent;
            document.getElementById("copyLinkBtn").textContent = "âœ“ Copied!";
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
            setTimeout(() => {
                document.getElementById("copyLinkBtn").textContent = originalText;
            }, 2000);
        }).catch(err => {
            alert("ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·: " + err);
        });
    });

})();
    </script>

</body>
</html>

</body>
</html>